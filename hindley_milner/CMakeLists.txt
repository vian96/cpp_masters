cmake_minimum_required(VERSION 3.20)
set(CMAKE_CXX_COMPILER "clang++")
set(CMAKE_C_COMPILER "clang")
project(hindley_milner)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# TODO:autogenerated by gpt. need to understand what happens here

# Add common compiler flags
add_compile_options(-Wall -Wextra -Wno-multichar)

# --- 1. Define a library for your core logic ---
# This glob finds all your project files EXCEPT main.cpp and tests.cpp
file(GLOB LIB_SOURCES
    "expr_parser.cpp"
    "expr_tree.cpp"
    "type_infer.cpp"
)

# Compile the core logic into a library named "expr_lib"
add_library(expr_lib STATIC ${LIB_SOURCES})

# Make headers in the project directory findable by targets that use this library
target_include_directories(expr_lib PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})


# --- 2. Build your main application ---
# The main executable is just main.cpp
add_executable(main main.cpp)

# Link your app against the core logic library
target_link_libraries(main PRIVATE expr_lib)


# --- 3. Setup Google Test ---
enable_testing()
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Windows
FetchContent_MakeAvailable(googletest)


# --- 4. Build your test executable ---
# The test executable is just tests.cpp
add_executable(run_tests tests.cpp)

# Link your tests against BOTH the core logic library and Google Test
# This is the key step that makes the `#include "gtest/gtest.h"` work
target_link_libraries(run_tests PRIVATE expr_lib GTest::gtest_main)

# Find the tests in the executable
include(GoogleTest)
gtest_discover_tests(run_tests)
